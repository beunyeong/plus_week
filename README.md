# ν”λ¬μ¤ μ£Όμ°¨ κ°μΈκ³Όμ  μ§„ν–‰ λ‚΄μ©
μ΄λ² ν”λ¬μ¤μ£Όμ°¨ κ°μΈκ³Όμ λ” μ§€κΈκΉμ§€ λ°°μ΄ **JPAμ‹¬ν™”**, **ν…μ¤νΈ μ½”λ“**, **μ„±λ¥ μµμ ν™”** κ°λ…μ„ κΈ°λ°μΌλ΅ μ§„ν–‰λμ—λ‹¤.
 
***

## π“ ν•„μκΈ°λ¥
## 1. Transactionalμ— λ€ν• μ΄ν•΄
- `createReservation` ν•¨μμ—μ„ **νΈλμ­μ…**μ„ μ μ©ν•μ—¬, ν•λ‚λΌλ„ μ—λ¬κ°€ λ°μƒν•λ©΄ λ¨λ“  μ‘μ—…μ΄ λ΅¤λ°±λλ„λ΅ κµ¬ν„ν–μµλ‹λ‹¤.
-  μ‘μ—…μ΄ μ •μƒμ μΌ κ²½μ°μ—λ§ μ €μ¥λλ„λ΅ `@Transactional` μ–΄λ…Έν…μ΄μ… μ¶”κ°€ ν–μµλ‹λ‹¤.
  - **κ²°κ³Ό** : **All or Nothing** νΈλμ­μ… λ³΄μ¥

## 2. μΈκ°€μ— λ€ν• μ΄ν•΄
- κΈ°μ΅΄ μ½”λ“μ—μ„ `ADMIN` κ¶ν• ν™•μΈ APIκ°€ λ„λ½λμ–΄ μμ—λ λ¬Έμ λ¥Ό κ°μ„ ν–μµλ‹λ‹¤.
- `/admin/*` URLμ— λ€ν•΄ ADMIN κ¶ν•μ„ ν™•μΈν•  μ μλ„λ΅ Interceptorλ¥Ό μ¶”κ°€ν–μµλ‹λ‹¤.

## 3. N+1μ— λ€ν• μ΄ν•΄
- κΈ°μ΅΄ μ½”λ“μ—μ„ λ¨λ“  μμ•½μ„ μ΅°ν μ‹, μ—°κ΄€λ μ—”ν‹°ν‹°(User, Item)μ„ μ΅°νν•κΈ° μ„ν•΄ **N+1 λ¬Έμ **κ°€ λ°μƒν–μµλ‹λ‹¤.
- μ΄λ¥Ό κ°μ„ ν•κΈ° μ„ν•΄ `JOIN FETCH`λ¥Ό ν™μ©ν•μ—¬ `Reservation`, `User`, `Item` λ°μ΄ν„°λ¥Ό ν• λ²μ μΏΌλ¦¬λ΅ λ¨λ‘ κ°€μ Έμ¤λ„λ΅ μμ • ν–μµλ‹λ‹¤.
  - κ΄€λ ¨ λ©”μ„λ“ : `findAllWithUserAndItem()`
  - κ²°κ³Ό : λ™μΌν• λ°μ΄ν„°λ¥Ό μ΅°ν μ‹ N+1 λ¬Έμ λ¥Ό ν•΄κ²°ν•κ³  μ„±λ¥ μµμ ν™”

## 4. DB μ ‘κ·Ό μµμ†ν™”
- κΈ°μ΅΄ μ½”λ“μ—μ„ `findById`λ΅ μ‚¬μ©μ ID ν•λ‚μ”© μ΅°νν•κ³  μƒνƒλ¥Ό λ³€κ²½ν• ν›„ μ €μ¥ν•λ λ°©μ‹μ„ κ°μ„ ν–μµλ‹λ‹¤.
- `userRepository.updateUserStatusInGroup()` λ©”μ„λ“λ¥Ό ν†µν•΄ **userIds**μ™€ **status**λ¥Ό ν• λ²μ μΏΌλ¦¬λ΅ μ²λ¦¬ν•λ„λ΅ λ³€κ²½ ν–μµλ‹λ‹¤.

## 5. λ™μ  μΏΌλ¦¬μ— λ€ν• μ΄ν•΄
- κΈ°μ΅΄ μ½”λ“μ—μ„ `userId`, `itemId` μ΅°κ±΄μ— λ”°λΌ λ‹¤λ¥Έ λ©”μ„λ“κ°€ νΈμ¶λλ” λ°©μ‹κ³Ό μ—°κ΄€ μ—”ν‹°ν‹° μ΅°ν μ‹ μ¶”κ°€ μΏΌλ¦¬κ°€ μ‹¤ν–‰λμ–΄ **N+1 λ¬Έμ **κ°€ λ°μƒν–μµλ‹λ‹¤.
- **QueryDSL**μ„ μ‚¬μ©ν•΄ λ™μ  μΏΌλ¦¬λ¥Ό μ‘μ„±ν•κ³ , **JOIN FETCH**λ¥Ό ν†µν•΄ κ΄€λ ¨λ λ°μ΄ν„°λ¥Ό ν• λ²μ μΏΌλ¦¬λ΅ μ²λ¦¬ν•λ„λ΅ μμ •ν–μµλ‹λ‹¤.

## 6. ν•„μ”ν• λ¶€λ¶„λ§ κ°±μ‹ ν•κΈ°
- `Item` μ—”ν‹°ν‹°μ `status` μ»¬λΌμ€ `nullable = false`λ΅ μ„¤μ •λμ–΄, κ°’μ΄ μ—†μ„ κ²½μ° **Column 'status' cannot be null** μ—λ¬κ°€ λ°μƒν–μµλ‹λ‹¤.
- **`@DynamicInsert`** μ–΄λ…Έν…μ΄μ…μ„ μ μ©ν•΄, κ°’μ΄ μ „λ‹¬λμ§€ μ•μ„ κ²½μ° λ°μ΄ν„°λ² μ΄μ¤ κΈ°λ³Έκ°’(`PENDING`)μ΄ μλ™μΌλ΅ μ…λ ¥λλ„λ΅ μμ •ν–μµλ‹λ‹¤.

## 7. λ¦¬ν©ν† λ§
- κΈ°μ΅΄ μ½”λ“μ—μ„ λ°κ²¬λ μ—¬λ¬ λ¬Έμ λ¥Ό λ¦¬ν©ν† λ§ν–μµλ‹λ‹¤:
    1. **if-else μ κ±°**: μƒνƒ κ²€μ¦ λ©”μ„λ“(`validateStatusTransition`)μ™€ μƒνƒ μ—…λ°μ΄νΈ λ©”μ„λ“(`updateStatus`)λ¥Ό ν™μ©ν•μ—¬ λ¶ν•„μ”ν• `if-else` κµ¬λ¬Έμ„ μ κ±°ν–μµλ‹λ‹¤.
    2. **μ¤‘λ³µλ `findById` νΈμ¶ μ κ±°**: `ReservationRepository`μ— **`findByIdOrThrow`** κΈ°λ³Έ λ©”μ„λ“λ¥Ό μ¶”κ°€ν•΄ μ¤‘λ³µ λ΅μ§μ„ ν•΄κ²°ν–μµλ‹λ‹¤.
    3. **μƒνƒ κ°’ Enum κ΄€λ¦¬**: λ¬Έμμ—΄ κΈ°λ° μƒνƒ κ΄€λ¦¬μ—μ„ `ReservationStatus` EnumμΌλ΅ μ „ν™ν•΄ μƒνƒλ¥Ό λ…ν™•ν κ΄€λ¦¬ν•λ„λ΅ κ°μ„ ν–μµλ‹λ‹¤.

## 8. ν…μ¤νΈ μ½”λ“
- **PasswordEncoder λ‹¨μ„ ν…μ¤νΈ**
  - μ•”νΈν™”λ λΉ„λ°€λ²νΈλ” **nullμ΄ μ•„λ‹**μ„ κ²€μ¦ β†’ `testEncode_NotNull()`
  - μ•”νΈν™”λ λΉ„λ°€λ²νΈλ” **μ›λ³Έ λΉ„λ°€λ²νΈμ™€ λ‹¤λ¦„**μ„ κ²€μ¦ β†’ `testEncode_NotSameAsRawPassword()`


- **Item Entity ν…μ¤νΈ**
  - `Item` μ—”ν‹°ν‹°μ `status` μ»¬λΌμ΄ `nullable = false`λ΅ μ„¤μ •λμ–΄ μλ”μ§€ κ²€μ¦ν–μµλ‹λ‹¤.
  - JPQLμ„ μ΄μ©ν•΄ `status`λ¥Ό nullλ΅ μ—…λ°μ΄νΈν•λ ¤ ν•  κ²½μ°, **PersistenceException**μ΄ λ°μƒν•λ”μ§€ ν™•μΈ
   - κ΄€λ ¨ λ©”μ„λ“ : `updateStatusToNull_shouldNull()`


***
## π“ λ„μ „ κΈ°λ¥
## 9. ν…μ¤νΈ μ½”λ“
- **1. Controller Test μ§„ν–‰**
- `@WebMvcTest`λ¥Ό ν™μ©ν•΄ **ReservationController**μ λ™μ‘μ„ κ²€μ¦ν–μµλ‹λ‹¤.
  - [POST /reservation] μ”μ²­μ΄ μ¬λ°”λ¥Έ λ°μ΄ν„°λ΅ νΈμ¶λμ—μ„ λ•, μ„±κ³µ μ‘λ‹µ(`201 Created`)μ„ λ°ν™ν•λ”μ§€ ν…μ¤νΈν–μµλ‹λ‹¤.


- **2. π¥²Service Test** ----> λ„μ „ μ‹¤ν¨

## 10. ν…μ¤νΈ ν™κ²½ λ¶„λ¦¬
- Localκ³Ό Test ν™κ²½μ DBλ¥Ό λ¶„λ¦¬ν•κΈ° μ„ν•΄ ν™κ²½λ³„ yml μ„¤μ • νμΌμ„ μ‘μ„±ν–μµλ‹λ‹¤.
  - `application-local.yml` β†’ Local ν™κ²½ DB μ—°κ²° μ„¤μ •.
  - `application-test.yml` β†’ Test ν™κ²½ DB μ΄κΈ°ν™” λ° μ—°κ²° μ„¤μ •.
- κ° ν™κ²½μ—μ„ λ°μ΄ν„°λ² μ΄μ¤ μ„¤μ •μ΄ μ •μƒμ μΌλ΅ μ‘λ™ν•λ”μ§€ ν™•μΈν–μµλ‹λ‹¤.


## 11. π¥²AWS ν™μ© λ§μ¤ν„° ----> λ„μ „ μ‹¤ν¨
- AWS ν™μ©μ„ ν†µν•΄ μ„λΉ„μ¤λ¥Ό λ°°ν¬ν•λ ¤ ν–μ§€λ§, μ΄λ² κ³Όμ μ—μ„λ” μ™„μν•μ§€ λ»ν–μµλ‹λ‹¤.
  - **κµν›**: λ°°ν¬ μλ™ν™”μ™€ AWS μ„¤μ •μ— λ€ν• μ¶”κ°€ ν•™μµ ν•„μ”μ„±μ„ ν™•μΈν–μµλ‹λ‹¤.